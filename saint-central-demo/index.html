<!DOCTYPE html>
<html>
  <head>
    <title>Test Inline Fix</title>
  </head>
  <body>
    <h1>üéØ Test Inline Fix - No External Function Calls</h1>
    <button onclick="testInlineFix()">Test Inline Fix</button>
    <pre id="output"></pre>

    <script type="module">
      window.testInlineFix = async function () {
        const output = document.getElementById("output");
        output.textContent = "";

        function log(msg) {
          output.textContent += msg + "\n";
          console.log(msg);
        }

        try {
          log("=== TESTING INLINE FIX ===");

          const { createClient } = await import("../sdk/index.js");

          const client = createClient(
            "https://saint-central-api.colinmcherney.workers.dev",
            {
              debug: true,
              enableEncryption: true,
            }
          );

          log("‚úÖ Client created");

          const testData = { test: "hello world", timestamp: Date.now() };
          log(`Testing: ${JSON.stringify(testData)}`);

          // Test encryption (now fully inline)
          const encrypted = await client
            ._getManagers()
            .encryption.encrypt(testData);
          log(`‚úÖ Encryption works! ${JSON.stringify(encrypted)}`);

          // Test decryption (now fully inline)
          const decrypted = await client
            ._getManagers()
            .encryption.decrypt(encrypted);
          log(`‚úÖ Decryption works! ${JSON.stringify(decrypted)}`);

          // Test full auth flow
          const email = `test-${Date.now()}@example.com`;
          log(`\nTesting auth with: ${email}`);

          const authResult = await client.auth.signUp({
            email: email,
            password: "SecurePassword123!@#",
          });

          if (authResult.error) {
            log(`Auth: ${authResult.error.message}`);
          } else {
            log(
              `‚úÖ Auth successful! User: ${
                authResult.data?.user?.email || "Unknown"
              }`
            );
          }

          // Test database
          const dbResult = await client.from("users").select("*").limit(5);
          if (dbResult.error) {
            log(`DB: ${dbResult.error.message}`);
          } else {
            log(`‚úÖ Database works! Got ${dbResult.data?.length || 0} results`);
          }

          log("\nüéâ SUCCESS! Inline crypto operations work! üéâ");
        } catch (error) {
          log(`‚ùå ERROR: ${error.message}`);
          log(`Stack: ${error.stack}`);
        }
      };
    </script>
  </body>
</html>
